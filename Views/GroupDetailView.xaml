<UserControl x:Class="VrchatgroupApp.clean.Views.GroupDetailView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="clr-namespace:VrchatgroupApp.clean.ViewModels"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             mc:Ignorable="d">

    <Grid Background="{StaticResource PanelBrush}">

        <Grid.RowDefinitions>
            <RowDefinition Height="180"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- ================= HEADER / BANNER ================= -->

        <Grid Grid.Row="0">

            <!-- Banner -->
            <Border Background="#222">
                <Image Source="{Binding BannerUrl}"
                       Stretch="UniformToFill"
                       Opacity="0.85"/>
            </Border>

            <!-- Overlay -->
            <Border Background="#80000000"/>

            <!-- Header content -->
            <StackPanel Orientation="Horizontal"
                        VerticalAlignment="Bottom"
                        Margin="24">

                <!-- Icon -->
                <Border Width="64"
                        Height="64"
                        Background="#333"
                        CornerRadius="12"
                        Margin="0,0,16,0">
                    <Image Source="{Binding IconUrl}"
                           Stretch="UniformToFill"/>
                </Border>

                <!-- Title + counts -->
                <StackPanel>

                    <TextBlock Text="{Binding Name}"
                               FontSize="24"
                               FontWeight="SemiBold"/>

                    <StackPanel Orientation="Horizontal"
                                Margin="0,6,0,0">

                        <TextBlock Text="{Binding OnlineCount}"
                                   Foreground="#3CFF7A"
                                   FontWeight="SemiBold"/>

                        <TextBlock Text=" online • "
                                   Margin="4,0"/>

                        <TextBlock Text="{Binding MemberCount}"
                                   Opacity="0.8"/>

                        <TextBlock Text=" members"
                                   Opacity="0.6"
                                   Margin="4,0,0,0"/>
                    </StackPanel>

                </StackPanel>
            </StackPanel>

        </Grid>

        <!-- ================= BODY ================= -->

        <Grid Grid.Row="1"
              Margin="24">

            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>

            <!-- Status / error -->
            <TextBlock Text="{Binding StatusMessage}"
                       Foreground="Tomato"
                       Margin="0,0,0,12"
                       Visibility="{Binding StatusMessage,
                                    Converter={StaticResource BoolToVisibility}}"/>

            <!-- Members list -->
            <ListView Grid.Row="1"
                      ItemsSource="{Binding Members}"
                      SelectedItem="{Binding SelectedMember}"
                      Background="#141414"
                      BorderBrush="{StaticResource SoftBorder}"
                      BorderThickness="1">

                <ListView.ItemTemplate>
                    <DataTemplate>

                        <Grid Margin="10">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="40"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>

                            <!-- Avatar -->
                            <Border Width="32"
                                    Height="32"
                                    CornerRadius="16"
                                    Background="#333">
                                <Image Source="{Binding ProfileImageUrl}"
                                       Stretch="UniformToFill"/>
                            </Border>

                            <!-- Name -->
                            <TextBlock Grid.Column="1"
                                       Text="{Binding DisplayName}"
                                       VerticalAlignment="Center"
                                       Margin="12,0"/>

                            <!-- Permission icon -->
                            <TextBlock Grid.Column="2"
                                       Text="🛠"
                                       FontSize="14"
                                       VerticalAlignment="Center"
                                       Visibility="{Binding DataContext.CanModerateMembers,
                                                    RelativeSource={RelativeSource AncestorType=ListView},
                                                    Converter={StaticResource BoolToVisibility}}"/>
                        </Grid>

                    </DataTemplate>
                </ListView.ItemTemplate>

            </ListView>

        </Grid>

    </Grid>
</UserControl>
